# 条件工作流

作用：允许用户自定义执行条件来决定是否运行某些 Job。

条件可以由当前 Job 的 父Job 输出的`运行时参数`构成，也可以使用`预定义宏`。

在这些条件下，用户可以在确定 Job 执行逻辑时获得更大的灵活性。
例如：1个子job依赖2个父job，只要父 Job 之一成功，就可以运行当前 Job。

### 一、运行时参数

#### 原理

1. 父Job 将参数写入 `JOB_OUTPUT_PROP_FILE` 环境变量所指向的文件
2. 子Job 使用 `${jobName:param}` 来获取 父Job 输出的参数并定义执行条件

#### 支持的运算符

1. `==` 等于
2. `!=` 不等于
3. `>` 大于
4. `>=` 大于等于
5. `<` 小于
6. `<=` 小于等于
7. `&&` 与
8. `||` 或
9. `!` 非

#### 需求

- JobA 执行一个 shell 脚本。
- JobB 执行一个 shell 脚本，但 JobB 不需要每天都执行，而只需要每个周一执行。

#### 实现

##### 1、配置文件准备

[condition.project](./09-job/condition.project)

```yaml
azkaban-flow-version: 2.0
```

[condition.flow](./09-job/condition.flow)

```yaml
nodes:
  - name: JobA
    type: command
    config:
      command: sh JobA.sh

  - name: JobB
    type: command
    dependsOn:
      - JobA
    config:
      command: sh JobB.sh
    # 指定执行条件：JobA执行完后 wk为0，才执行JobB
    condition: ${JobA:wk} == 0
```

[JobA.sh](./09-job/JobA.sh)

```shell
#!/bin/bash
echo "do JobA"
wk=`date +%w`
echo "{\"wk\":$wk}" > $JOB_OUTPUT_PROP_FILE
```

[JobB.sh](./09-job/JobB.sh)

```shell
#!/bin/bash
echo "do JobB"
```

##### 2、web配置执行任务

![](./images/09-条件工作流_1736682017215.png)

不满足条件执行效果
![](./images/09-条件工作流_1736681792203.png)

满足条件执行效果
![](./images/09-条件工作流_1736681988701.png)

### 二、预定义宏