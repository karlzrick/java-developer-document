# Git钩子（Git Hooks）

功能：允许你在特定事件发生时触发自定义脚本。这些事件包括提交之前、提交之后、推送之前等。
通过使用Git钩子，你可以自动化执行一些任务，比如代码风格检查、运行测试、阻止不符合规范的提交等。

以下是常用的几种Git钩子：

- **pre-commit**：在提交之前运行，常用于代码格式化或检查。
- **commit-msg**：在提交信息编辑完成但尚未记录之前运行，可以用来验证提交信息的格式。
- **post-commit**：在提交完成后运行，可用于通知或其他后处理任务。
- **pre-push**：在`git push`命令开始之前运行，通常用于防止不符合要求的代码推送到远程仓库。
- **pre-receive**、**update**、**post-receive**：这些钩子位于服务器端，在接收来自客户端的推送时触发。

### 1、如何创建和使用Git钩子

1. **进入项目的.git/hooks目录**：
   每个Git仓库都有一个`.git/hooks`目录，默认情况下该目录下有一些示例钩子文件。
2. **编写钩子脚本**：
   你可以根据需要创建一个新的钩子文件或者修改已有的示例文件。钩子文件通常是可执行的Shell脚本，但也可以是其他语言编写的程序（如Python、Ruby等），只要确保它们可以通过解释器正确执行。
3. **使钩子文件可执行**：
   使用`chmod +x <hook-file>`命令赋予钩子文件执行权限。
4. **测试钩子**：
   触发相应的Git操作（例如做一次提交或推送），以确保你的钩子按预期工作。
5. **共享钩子**：
   如果希望团队成员都能使用你设置好的钩子，可以将钩子脚本放在项目根目录中，并编写安装说明指导他人如何配置。

请注意，虽然Git钩子非常有用，但也应该谨慎使用，特别是当涉及到多人协作开发时，确保所有开发者都了解并同意使用的钩子规则。

### 2、示例：Git钩子-提交信息后自动添加分支名称

使用 `commit-msg` 钩子来修改提交信息。

#### 1、进入 Git 仓库的 hooks 目录

```shell
cd .git/hooks
```

#### 2、创建或编辑 `commit-msg` 钩子脚本

```shell
touch commit-msg
chmod +x commit-msg
```

![](./images/23-Git钩子-提交时自动追加分支名称-1740658899551.png)


#### 3、编写 `commit-msg` 钩子脚本

```shell
#!/bin/sh

# 获取当前分支名称
branch_name=$(git rev-parse --abbrev-ref HEAD)

# 读取原始提交信息
commit_msg=$(cat $1)

# 检查提交信息是否已经包含分支名称
if ! echo "$commit_msg" | grep -q "\[$branch_name\]"; then
    # 在提交信息末尾添加分支名称
    echo "$commit_msg" | sed "s/$/ [$branch_name]/" > $1
fi
```

#### 4、保存并退出编辑器

这样，每次你提交代码时，`commit-msg` 钩子会自动在提交信息的末尾添加当前分支的名称。

#### 5、示例

假设你当前在 `feature-branch` 分支上，提交信息为 `Fix bug`，那么提交后，提交信息会自动变为 `Fix bug [feature-branch]`。
![](./images/23-Git钩子-提交时自动追加分支名称-1740658972883.png)

